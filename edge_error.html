<!DOCTYPE html>
<html>
<head>
<title>XML Error</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
<script>
function doInit() {
  document.getElementById("ua").innerHTML = navigator.userAgent;
  run();
}

function run() {
  var str = document.getElementById("src").value;
  var parser = new DOMParser();
  var dom = parser.parseFromString(str, "text/xml");
  var stringMaker = new XMLSerializer();
  document.getElementById("dest").value = stringMaker.serializeToString(dom);
  document.getElementById("node").value = serialize(dom);

}

function serialize(node) {
  try {
    switch (node.nodeType) {
      case 1:
        var xml = "<" + node.tagName;
        for (var i = 0; i < node.attributes.length; ++i) {
          var attribute = node.attributes[i];
          if (attribute == null) {
            continue;
          }
          if (attribute.specified) {
            xml += serialize(attribute);
          }
        }
        if (node.hasChildNodes()) {
          xml += ">";
          for (var child = node.firstChild; child != null; child = child.nextSibling) {
            xml += serialize(child);
          }
          xml += "</" + node.tagName + ">";
        } else {
          xml += "></" + node.tagName + ">";
        }
        return xml;
      case 2:
        var name = node.name;
        var value = node.value.replace(/&/g, "&amp;").replace(/"/g, "&quot;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        return " " + name + "=\"" + value + "\"";
      case 3:
        return node.data.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
      case 4:
        return "<![CDATA[" + node.data.replace(/]]>/g, "]]]]><![CDATA[>") + "]]>";
      case 9:
        var xml = "";
        for (var child = node.firstChild; child != null; child = child.nextSibling) {
          xml += serialize(child) + "\n";
        }
        return xml;
      case 11:
        var xml = "";
        for (var child = node.firstChild; child != null; child = child.nextSibling) {
          xml += serialize(child);
        }
        return xml;
    }
  } catch (e) {
    alert(e);
  }
};
window.onload = doInit;
</script>
</head>
<body>
<h3 id="ua"></h3>
<h4> XML </h4>
<textarea id="src" style="border:1px solid #777;width:95%;height:100px"><html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script type="javascript"><![CDATA[]]></script>
    </head>
    <body></body>
</html>
</textarea>
<br>
<input type="button" value="RUN" onclick="run()">
<br>

<h4> (new XMLSerializer()).serializeToString() </h4>
<textarea id="dest" style="border:1px solid #777;width:95%;height:100px"></textarea>
<h4> custom serializer - DOM Traverse </h4>
<textarea id="node" style="border:1px solid #777;width:95%;height:100px"></textarea>

</body>
</html>
